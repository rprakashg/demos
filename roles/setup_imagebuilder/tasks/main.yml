---
- name: create infrastructure resources
  ansible.builtin.import_tasks: create_infra.yml
  when: create_infra | default(true)

- name: check if system is registered with subscription-manager
  ansible.builtin.shell: "subscription-manager status"
  register: status_result
  ignore_errors: yes

- name: register system if not already registered
  ansible.builtin.import_tasks: register_system.yml
  when: status_result.rc != 0

- name: setup cockpit
  ansible.builtin.import_tasks: setup_cockpit.yml
  when: cockpit | default(true)

- name: setup imagebuilder
  ansible.builtin.import_tasks: setup_imagebuilder.yml
